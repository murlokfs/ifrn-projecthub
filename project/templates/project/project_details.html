{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProjectHub - Plataforma de Portf√≥lio</title>
    <link rel="stylesheet" href="{% static 'css/project_details.css' %}">
    <link rel="stylesheet" href="{% static 'css/aprovacao.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <header class="header">
        <div class="header__container">
            <button class="btn btn--ghost btn--sm" onclick="history.back()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                Voltar
            </button>
            
            <div class="header__actions">
                <button class="btn btn--ghost btn--sm btn--like-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                    <span class="btn__text-hidden-mobile" id="project-like-count">89</span>
                </button>

                <button class="btn btn--ghost btn--sm" onclick="copyLink()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>
                    <span class="btn__text-hidden-mobile">Compartilhar</span>
                </button>

                {% if show_approval_button %}
                <button class="btn btn--primary btn--sm" onclick="(typeof openModal==='function') ? openModal() : (document.getElementById('evaluationModal') ? document.getElementById('evaluationModal').style.display='flex' : null)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                    <span class="btn__text-hidden-mobile">Confirmar avalia√ß√£o</span>
                </button>
                {% endif %}

                <button class="btn btn--ghost btn--sm btn--report" onclick="toggleModal('modal-report')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>
                    <span class="btn__text-hidden-mobile">Denunciar</span>
                </button>
            </div>
        </div>
    </header>

    {% if project.get_youtube_embed_url %}
    <section class="hero-section">
        <div class="hero-section__container">
            <div class="video-wrapper">
                <iframe id="project-video" width="853" height="480" src="{{ project.get_youtube_embed_url }}?rel=0&modestbranding=1&playsinline=1" title="V√≠deo do projeto" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
            </div>
        </div>
    </section>
    {% endif %}

    <main class="main-content">
        <div class="project-header">
            <div class="project-header__badges">
                <span class="floating-tag">{{ project.get_type_display }}</span>
                {% if project.status == 'completed' %}
                    <span class="status-badge outline-green">{{ project.get_status_display }}</span>
                {% elif project.status == 'in_progress' %}
                    <span class="status-badge outline-blue">{{ project.get_status_display }}</span>
                {% elif project.status == 'pending_approval' %}
                    <span class="status-badge outline-yellow">{{ project.get_status_display }}</span>
                {% elif project.status == 'reproved' %}
                    <span class="status-badge outline-red">{{ project.get_status_display }}</span>
                {% endif %}
            </div>

            <h1 class="project-title">{{ project.title }}</h1>

            <div class="project-meta">
                <div class="meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                    <span>Criado em {{ project.created_at|date:"d/m/Y" }}</span>
                </div>
            </div>

            <div class="project-tags tags-row">
                {% for tag in project.tags.all %}
                    <span class="tech-tag">{{ tag.name }}</span>
                {% empty %}
                    <span class="tech-tag">Sem tags</span>
                {% endfor %}
            </div>
        </div>

        <div class="grid-layout">
            
            <div class="column-main">
                
                <article class="card">
                    <header class="card__header">
                        <h2 class="card__title">üìñ Sobre o Projeto</h2>
                    </header>
                    <div class="card__content">
                        <div class="markdown-content">{{ project.description|safe }}</div>
                    </div>
                </article>

                <section class="card">
                    <header class="card__header">
                        <h2 class="card__title flex-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                            Coment√°rios (3)
                        </h2>
                    </header>
                    <div class="card__content">
                        <div class="comment-form">
                            <textarea class="textarea" placeholder="Escreva seu coment√°rio sobre o projeto..."></textarea>
                            <button class="btn btn--primary">Publicar Coment√°rio</button>
                        </div>

                        <hr class="separator">

                        <div class="comments-list">
                            
                            <div class="comment-item">
                                <div class="avatar">
                                    <span class="avatar__fallback">JS</span>
                                </div>
                                <div class="comment-item__body">
                                    <div class="comment-item__header">
                                        <span class="comment-author">Jo√£o Silva</span>
                                        <span class="comment-date">‚Ä¢ 01/10/2025</span>
                                    </div>
                                    <p class="comment-text">Excelente projeto! A interface est√° muito intuitiva e bem pensada. Parab√©ns pelo trabalho!</p>
                                    <div class="comment-actions">
                                        <button class="btn-action" data-comment-like>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart-icon lucide-heart"><path d="M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5"/></svg>
                                            <span class="like-count">12</span>
                                        </button>
                                        <button class="btn-action btn-action--report">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="comment-item">
                                <div class="avatar">
                                    <span class="avatar__fallback">MS</span>
                                </div>
                                <div class="comment-item__body">
                                    <div class="comment-item__header">
                                        <span class="comment-author">Maria Santos</span>
                                        <span class="comment-date">‚Ä¢ 30/09/2025</span>
                                    </div>
                                    <p class="comment-text">Muito bom, mas poderia ter mais funcionalidades de filtro na busca.</p>
                                    <div class="comment-actions">
                                        <button class="btn-action" data-comment-like">
                                           <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart-icon lucide-heart"><path d="M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5"/></svg>
                                            <span class="like-count">5</span>
                                        </button>
                                        <button class="btn-action btn-action--report">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>
                                        </button>
                                    </div>
                                </div>
                            </div>

                             <div class="comment-item">
                                <div class="avatar">
                                    <span class="avatar__fallback">PO</span>
                                </div>
                                <div class="comment-item__body">
                                    <div class="comment-item__header">
                                        <span class="comment-author">Pedro Oliveira</span>
                                        <span class="comment-date">‚Ä¢ 28/09/2025</span>
                                    </div>
                                    <p class="comment-text">Projeto inovador e bem executado! Vai ajudar muito os estudantes.</p>
                                    <div class="comment-actions">
                                        <button class="btn-action" data-comment-like">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart-icon lucide-heart"><path d="M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5"/></svg>
                                            <span class="like-count">8</span>
                                        </button>
                                        <button class="btn-action btn-action--report">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>
                                        </button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </section>
            </div>

            <aside class="sidebar">
                
                <div class="card">
                    <header class="card__header">
                        <h3 class="card__title flex-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            Integrantes
                        </h3>
                    </header>
                    <div class="card__content list-spacing">
                        {% for member in project.members.all %}
                        <div class="user-item">
                            <a href="{% url 'profile' member.id %}" class="avatar avatar--sm">
                                {% if member.image %}
                                <img src="{{ member.image }}" alt="{{ member.full_name|default:member.username }}" class="avatar__image" style="object-fit: cover; width: 100%; height: 100%;">
                                {% else %}
                                <span class="avatar__fallback">{{ member.full_name|default:member.username|slice:":2"|upper }}</span>
                                {% endif %}
                            </a>
                            <div class="user-item__info">
                                <p class="user-name"><a href="{% url 'profile' member.id %}">{{ member.full_name|default:member.username }}</a></p>
                            </div>
                        </div>
                        {% empty %}
                        <p>Nenhum integrante cadastrado.</p>
                        {% endfor %}
                    </div>
                </div>

                <div class="card">
                    <header class="card__header">
                        <h3 class="card__title flex-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
                            Professor Orientador
                        </h3>
                    </header>
                    <div class="card__content">
                        {% for orientator in project.orientators.all %}
                        <div class="user-item">
                            <a href="{% url 'profile' orientator.id %}" class="avatar avatar--md" style="text-decoration: none;">
                                {% if orientator.image %}
                                <img src="{{ orientator.image }}" alt="{{ orientator.full_name|default:orientator.username }}" class="avatar__image" style="object-fit: cover; width: 100%; height: 100%;">
                                {% else %}
                                <span class="avatar__fallback bg-primary-soft">{{ orientator.full_name|default:orientator.username|slice:":2"|upper }}</span>
                                {% endif %}
                            </a>
                            <div class="user-item__info">
                                <p class="user-name"><a href="{% url 'profile' orientator.id %}">{{ orientator.full_name|default:orientator.username }}</a></p>
                            </div>
                        </div>
                        {% empty %}
                        <p>Nenhum orientador cadastrado.</p>
                        {% endfor %}
                    </div>
                </div>

                {% if project.link_github or project.link_youtube %}

                <div class="card">
                    <header class="card__header">
                        <h3 class="card__title flex-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                            Links do Projeto
                        </h3>
                    </header>
                    <div class="card__content list-spacing">
                        {% if project.link_github %}
                        <a href="{{ project.link_github }}" target="_blank" rel="noopener noreferrer" class="link-card group">
                            <div class="link-card__icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                            </div>
                            <div class="link-card__info">
                                <p class="link-title">Reposit√≥rio GitHub</p>
                                <p class="link-url">Abrir no GitHub</p>
                            </div>
                            <svg class="external-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>
                        </a>
                        {% endif %}
                        {% if project.link_youtube %}
                        <a href="{{ project.link_youtube }}" target="_blank" rel="noopener noreferrer" class="link-card group">
                            <div class="link-card__icon link-card__icon--youtube">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.5 17a24.12 24.12 0 0 1 0-10 a2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17"/><path d="m10 15 5-3-5-3z"/></svg>
                            </div>
                            <div class="link-card__info">
                                <p class="link-title">V√≠deo no YouTube</p>
                                <p class="link-url">Assistir no YouTube</p>
                            </div>
                            <svg class="external-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>
                        </a>
                        {% endif %}
                    </div>
                </div>

                {% endif %}

                <div class="card card--gradient">
                    <div class="card__content">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="project-likes-count">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5"/></svg>
                                    <span id="project-likes-number">89</span>
                                </div>
                                <p class="stat-label">Curtidas</p>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                                    38
                                </div>
                                <p class="stat-label">Coment√°rios</p>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

        </div>
    </main>

    {% include 'components/modals/modal_approval.html' %}
    <script>
        (function(){
            if (typeof openModal !== 'function') {
                window.openModal = function(){
                    var m = document.getElementById('evaluationModal');
                    if (m) { m.style.display = 'flex'; }
                };
            }
        })();
    </script>
    {% include 'components/modals/modal_report.html' %}

    <script>
        function toggleModal(id) {
            const modal = document.getElementById(id);
            const isHidden = modal.getAttribute('aria-hidden') === 'true';
            modal.setAttribute('aria-hidden', !isHidden);
            modal.style.display = isHidden ? 'flex' : 'none';
        }
        function copyLink() {
            const url = window.location.href;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url).then(() => {
                    alert('Link copiado para a √°rea de transfer√™ncia!');
                }).catch(() => alert('N√£o foi poss√≠vel copiar o link.'));
            } else {
                const input = document.createElement('input');
                input.value = url;
                document.body.appendChild(input);
                input.select();
                try { document.execCommand('copy'); alert('Link copiado!'); } catch {}
                document.body.removeChild(input);
            }
        }
        (function() {
            // Like do projeto com espelhamento nas m√©tricas
            const likeBtn = document.querySelector('.btn--like-toggle');
            const headerCountSpan = document.getElementById('project-like-count');
            const likesStatNumber = document.getElementById('project-likes-number');
            let liked = false;
            let count = parseInt(headerCountSpan?.textContent || '0', 10) || 0;
            // Espelha valor inicial
            if (likesStatNumber) {
                likesStatNumber.textContent = String(count);
            }

            const iframe = document.getElementById('project-video');
            const vid = iframe?.getAttribute('data-video-id');
            if (iframe && vid) {
                const src = `https://www.youtube.com/embed/${vid}?rel=0&modestbranding=1&playsinline=1`;
    
                if (!iframe.getAttribute('src') || !iframe.getAttribute('src')?.includes(`/embed/${vid}`)) {
                    iframe.setAttribute('src', src);
                }
            }
            likeBtn?.addEventListener('click', function() {
                liked = !liked;
                count = liked ? count + 1 : Math.max(0, count - 1);
                if (headerCountSpan) headerCountSpan.textContent = String(count);
                likeBtn.classList.toggle('is-liked', liked);
                if (likesStatNumber) {
                    likesStatNumber.textContent = String(count);
                }
            });

            // Likes nos coment√°rios
            const commentLikeButtons = document.querySelectorAll('[data-comment-like]');
            commentLikeButtons.forEach((btn) => {
                const countEl = btn.querySelector('.like-count');
                let likedComment = false;
                let commentCount = parseInt(countEl?.textContent || '0', 10) || 0;
                btn.addEventListener('click', function() {
                    likedComment = !likedComment;
                    commentCount = likedComment ? commentCount + 1 : Math.max(0, commentCount - 1);
                    if (countEl) countEl.textContent = String(commentCount);
                    btn.classList.toggle('is-liked', likedComment);
                });
            });

            const commentReportButtons = document.querySelectorAll('.btn-action--report');
            commentReportButtons.forEach((btn) => {
                btn.addEventListener('click', function() {
                    toggleModal('modal-report');
                });
            });
        })();
    </script>
</body>
</html>
