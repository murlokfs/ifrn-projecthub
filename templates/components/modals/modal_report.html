<div id="modal-report" class="modal" aria-hidden="true" data-project-id="">
    <div class="modal__overlay" onclick="toggleModal('modal-report')"></div>
    <div class="modal__content">
        <header class="modal__header">
            <h2 class="modal__title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>
                Denunciar Projeto
            </h2>
            <p class="modal__description">Selecione o motivo da denúncia. Nossa equipe irá analisar e tomar as medidas necessárias.</p>
        </header>
        
        <div class="radio-group">
            <label class="radio-item">
                <input type="radio" name="report_reason" value="plagio">
                <div class="radio-item__content">
                    <span class="radio-label">Plágio</span>
                    <span class="radio-desc">O projeto copia conteúdo de outros sem autorização</span>
                </div>
            </label>
            <label class="radio-item">
                <input type="radio" name="report_reason" value="inapropriado">
                <div class="radio-item__content">
                    <span class="radio-label">Conteúdo Inapropriado</span>
                    <span class="radio-desc">Contém linguagem ofensiva ou imagens inadequadas</span>
                </div>
            </label>
            <label class="radio-item">
                <input type="radio" name="report_reason" value="falso">
                <div class="radio-item__content">
                    <span class="radio-label">Informação Falsa</span>
                    <span class="radio-desc">As informações do projeto são falsas ou enganosas</span>
                </div>
            </label>
        </div>

        <footer class="modal__footer">
            <button class="btn btn--ghost" onclick="toggleModal('modal-report')">Cancelar</button>
            <button class="btn btn--destructive" onclick="submitProjectReport()">Enviar Denúncia</button>
        </footer>
    </div>
</div>

<script>
    // Função para abrir modal com ID do projeto
    function openReportModal(projectId) {
        const modal = document.getElementById('modal-report');
        if (modal) {
            modal.setAttribute('data-project-id', projectId);
            toggleModal('modal-report');
        }
    }

    // Função para enviar denúncia
    function submitProjectReport() {
        const modal = document.getElementById('modal-report');
        const projectId = modal.getAttribute('data-project-id');
        
        // Obtém a opção selecionada
        const selectedReason = document.querySelector('input[name="report_reason"]:checked');
        
        if (!projectId) {
            alert('Erro: ID do projeto não encontrado');
            return;
        }
        
        if (!selectedReason) {
            alert('Por favor, selecione um motivo para a denúncia');
            return;
        }

        // Envia requisição POST via AJAX
        fetch(`/projects/report/${projectId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'),
            },
            body: JSON.stringify({
                reason: selectedReason.value
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                // Limpa a seleção
                selectedReason.checked = false;
                // Fecha o modal
                toggleModal('modal-report');
            } else {
                alert('Erro: ' + (data.message || 'Não foi possível enviar a denúncia'));
            }
        })
        .catch(error => {
            console.error('Erro na requisição:', error);
            alert('Erro ao tentar enviar a denúncia. Tente novamente.');
        });
    }

    // Função auxiliar para obter CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>